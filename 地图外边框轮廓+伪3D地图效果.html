<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<script src="./js/echarts.min.js"></script>
		<script src="./js/china.js"></script>
		<script src="./js/china_boundary.js"></script>
		<title>地图外边框轮廓+伪3D地图效果</title>
		<style>
			body {
						background-color: #0E2056;
						background-size: 50px 50px;
						background-image: linear-gradient(90deg, #0F225B 2px, transparent 2px, transparent 2px),
							linear-gradient(#0F225B, #0F225B 2px, transparent 2px, transparent 2px);
					}
					#map_tips span{
						width:25%;
						display: inline-block;
						text-align: center;
						height:30px;
						line-height: 30px;
						vertical-align: middle;
					}
					#map_tips span img{
						width:25px;
						height:8px;
						
					}
					#map_tips span img:first-child{
						margin-right:15px;
					}
			
					#map_tips span img:last-child{
						margin-left:15px;
						transform:rotateY(180deg);
					}
		</style>
	</head>

	<body>
		<div>
			<!-- 预先加载，避免等待 -->
			<img id="backImg" src="./images/background_image.jpg" style="display:none">
			<div id="map" style="height: 800px; width: 800px; margin: auto; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); position: relative;" ></div>
		</div>
		<script>
			const image = new Image();
					image.src = "./images/background_image.jpg";
					image.onload = function() {
						// 获取地图元素
						const echartContainer = document.getElementById('map');
						// 创建临时元素
						const canvasBackgroundImg = document.createElement('canvas');
						//重新裁剪图片，适应元素宽高
						canvasBackgroundImg.width = echartContainer.clientWidth;
						canvasBackgroundImg.height = echartContainer.clientHeight;
						const ctx = canvasBackgroundImg.getContext('2d');
						ctx.drawImage(image,0,0, echartContainer.clientWidth, echartContainer.clientHeight);
			
						//加载echart 配置
						loadEchartConfig(canvasBackgroundImg)
					};
			
					function loadEchartConfig(canvasBackgroundImg){
						var optionMap = {
							tooltip: {
								trigger: 'item',
								backgroundColor: 'rgba(0,0,0,0)',
								padding: 0,
								margin: 0,
								formatter:function(params){
									var name = params.name;
									var value = params.value || '暂无数据';
									return `
									<div id="map_tips" style="background-image:url(./images/tips_background.png);background-size:100%;width:325px;height:102px;color:white;padding:10px;
										 z-index: 9999;">
											<div style="height:30px;font-size: 18px;font-weight: bold; width:100%;margin-bottom: 5px;">
												<span style="width: 100%;"><img src="./images/tip_logo.png">${name}<img src="./images/tip_logo.png"></span></span>
											</div>
											<div style="display:inline-block;height:30px;color:rgba(54, 245, 203, 1);width:100%;">
												<span>${value}</span>
											</div>
										</div>`
								}
							},
							geo: [
							{
								map: 'china_boundary',
								silent: true,
								top:90,
								itemStyle: {
									normal: {
										areaColor: new echarts.graphic.LinearGradient(0, 0, 1, 0,[{
												offset: 0, color: 'rgba(35, 205, 247, 1)' // 0% 处的颜色
											}, {
												offset: 0.05, color: 'rgba(11, 60, 137, 1)' // 100% 处的颜色
											},{
												offset: 0.1, color: 'rgba(35, 197, 250, 1)' // 100% 处的颜色
											},{
												offset: 0.15, color: 'rgba(0, 60, 115, 1)' // 100% 处的颜色
											},{
												offset: 0.2, color: 'rgba(36, 208, 251, 1)' // 100% 处的颜色
											},{
												offset: 0.25, color: 'rgba(1, 31, 77, 1)' // 100% 处的颜色
											},{
												offset: 0.3, color: 'rgba(35, 236, 249, 1)' // 100% 处的颜色
											},{
												offset: 0.35, color: 'rgba(1, 30, 76, 1)' // 100% 处的颜色
											},{
												offset: 0.4, color: 'rgba(35, 223, 251, 1)' // 100% 处的颜色
											},{
												offset: 0.45, color: 'rgba(1, 33, 84, 1)' // 100% 处的颜色
											},{
												offset: 0.5, color: 'rgba(36, 194, 252, 1)' // 100% 处的颜色
											},{
												offset: 0.55, color: 'rgba(0, 25, 63, 1)' // 100% 处的颜色
											},{
												offset: 0.6, color: 'rgba(36, 209, 252, 1)' // 100% 处的颜色
											},{
												offset: 0.65, color: 'rgba(0, 25, 66, 1)' // 100% 处的颜色
											},{
												offset: 0.7, color: 'rgba(35, 208, 251, 1)' // 100% 处的颜色
											},{
												offset: 0.75, color: 'rgba(4, 44, 106, 1)' // 100% 处的颜色
											},{
												offset: 0.8, color: 'rgba(35, 207, 250, 1)' // 100% 处的颜色
											},{
												offset: 0.85, color: 'rgba(0, 37, 94, 1)' // 100% 处的颜色
											},{
												offset: 0.9, color: 'rgba(35, 145, 251, 1)' // 100% 处的颜色
											},{
												offset: 0.95, color: 'rgba(18, 152, 191, 1)' // 100% 处的颜色
											}])
										}
									}
								},
								
								{
									map: 'china_boundary',
									//避免边框选中，设置不响应事件
									silent: true,
									itemStyle: {
										normal: {
											//外边框大小
											borderWidth: 4,
											borderColor: 'rgba(54, 245, 203, 1)',
											shadowColor: 'rgba(54, 245, 203, 1)',
											//发光效果
											shadowBlur: 30,
											areaColor: "rgba(0, 0, 0,0)"
										},
										emphasis: {
											label: { show: false },
											areaColor: "rgba(0, 0, 0,0)",
										}
									}
								},{
									map: 'china',
									silent: true,
									//地图区域的多边形 图形样式
									itemStyle: {
										normal: {
											label: { show: false },
											areaColor: {
												image: canvasBackgroundImg.toDataURL('image/png'),
												repeat: 'no-repeat'
											},
											borderWidth: 1,
											borderColor: 'rgba(1, 139, 123,1)',
											shadowColor: 'rgba(1, 139, 123,0.4)',
											shadowBlur: 10
										},
										//是图形在高亮状态下的样式,比如在鼠标悬浮或者图例联动高亮时
										emphasis: {
											label: { show: false },
											borderWidth: 2,
											borderColor: 'rgba(253, 132, 2,1)',
											shadowColor: 'rgba(253, 132, 2,1)',
											shadowBlur: 2,
											areaColor: "rgba(253, 132, 2,0.2)",
										}
									}
								},
							],
							//配置属性
							series: [{
									type: 'map',
									mapType: 'china',
									//地图区域的多边形 图形样式
									itemStyle: {
										normal: {
											label: { show: false },
											areaColor: "rgba(0, 94, 165,0)",
											borderWidth: 0,
											borderColor: 'rgba(1, 139, 123,1)',
											shadowColor: 'rgba(1, 139, 123,0.4)',
											shadowBlur: 10
										},
										emphasis: {
											label: { show: false },
											borderWidth: 2,
											borderColor: 'rgba(253, 132, 2,1)',
											shadowColor: 'rgba(253, 132, 2,1)',
											shadowBlur: 2,
											areaColor: "rgba(253, 132, 2,0.2)",
										}
									},
									data: [
												{
		  "name": "北京市",
		  "value": 40
		},
											{
											"name": "天津市",
											"value": 75
											},
											{
											"name": "河北省",
											"value": 22
											},
											{
											"name": "山西省",
											"value": 73
											},
											{
											"name": "内蒙古自治区",
											"value": 37
											},
											{
											"name": "辽宁省",
											"value": 62
											},
											{
											"name": "吉林省",
											"value": 50
											},
											{
											"name": "黑龙江省",
											"value": 17
											},
											{
											"name": "上海市",
											"value": 67
											},
											{
											"name": "江苏省",
											"value": 44
											},
											{
											"name": "安徽省",
											"value": 50
											},
											{
											"name": "浙江省",
											"value": 32
											},
											{
											"name": "福建省",
											"value": 79
											},
											{
											"name": "江西省",
											"value": 24
											},
											{
											"name": "山东省",
											"value": 60
											},
											{
											"name": "河南省",
											"value": 38
											},
											{
											"name": "湖北省",
											"value": 17
											},
											{
											"name": "湖南省",
											"value": 67
											},
											{
											"name": "广东省",
											"value": 15
											},
											{
											"name": "广西壮族自治区",
											"value": 39
											},
											{
											"name": "海南省",
											"value": 22
											},
											{
											"name": "重庆市",
											"value": 39
											},
											{
											"name": "四川省",
											"value": 65
											},
											{
											"name": "贵州省",
											"value": 77
											},
											{
											"name": "云南省",
											"value": 27
											},
											{
											"name": "陕西省",
											"value": 53
											},
											{
											"name": "甘肃省",
											"value": 13
											},
											{
											"name": "青海省",
											"value": 15
											},
											{
											"name": "宁夏自治区",
											"value": 67
											},
											{
											"name": "新疆维吾尔自治区",
											"value": 52
											},
											{
											"name": "西藏自治区",
											"value": 13
											}
										]
								},]
						};
						// 标记value最大的3个省份
						var dataArr = optionMap.series[0].data.slice();
						dataArr.sort(function(a, b) { return b.value - a.value; });
						var top3 = dataArr.slice(0, 3);

						// 省份名到经纬度映射（部分示例，实际可补全）
						var geoCoordMap = {
							'福建省': [119.295144, 26.100779],
							'贵州省': [106.70722, 26.5982],
							'天津市': [117.200983, 39.084158],
							'上海市': [121.472644, 31.231706],
							'湖南省': [112.982279, 28.19409],
							'宁夏自治区': [106.278179, 38.46637],
							'四川省': [104.065735, 30.659462],
							'辽宁省': [123.429096, 41.796767],
							'山东省': [117.000923, 36.675807],
							'新疆维吾尔自治区': [87.617733, 43.792818],
							'江苏省': [118.767413, 32.041544],
							'广东省': [113.280637, 23.125178],
							'西藏自治区': [91.132212, 29.660361],
							// ...可补全其它省份
						};

						function convertData(data) {
							var res = [];
							for (var i = 0; i < data.length; i++) {
								var geoCoord = geoCoordMap[data[i].name];
								if (geoCoord) {
									res.push({
										name: data[i].name,
										value: geoCoord.concat(data[i].value)
									});
								}
							}
							return res;
						}

						optionMap.series.push({
							name: 'Top3',
							type: 'effectScatter',
							coordinateSystem: 'geo',
							data: convertData(top3),
							symbolSize: 12,
							showEffectOn: 'render',
							rippleEffect: {
								brushType: 'stroke',
								color: '#FFD700',
								scale: 4,
								period: 3
							},
							hoverAnimation: true,
							label: {
								show: true,
								formatter: function(params){
									return '{b|' + params.name + '}\n{v|' + params.value[2] + '}';
								},
								color: '#fff',
								fontSize: 12,
								position: 'top',
								backgroundColor: 'rgba(0,0,0,0.3)',
								borderRadius: 6,
								padding: [6, 12],
								shadowColor: '#000',
								shadowBlur: 8,
								rich: {
									b: {
										fontSize: 12,
										color: '#fff',
										textShadowColor: '#000',
										textShadowBlur: 6,
									},
									v: {
										fontSize: 12,
										color: '#fff',
										textShadowColor: '#000',
										textShadowBlur: 6
									}
								}
							},
							itemStyle: {
								color: '#fff',
								shadowBlur: 4,
								shadowColor: '#fff'
							},
							zlevel: 2
						});
						
						//初始化echarts实例
						var myChart = echarts.init(document.getElementById('map'));
						//使用制定的配置项和数据显示图表
						myChart.setOption(optionMap);
					};
		</script>


	</body>
</html>